<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Black Experience Community Calendar</title>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQQwmtpr17jHgx73ux6TaaXRJgwPqTTSM",
            authDomain: "bxe-community-calendar.firebaseapp.com",
            projectId: "bxe-community-calendar",
            storageBucket: "bxe-community-calendar.firebasestorage.app",
            messagingSenderId: "99255180622",
            appId: "1:99255180622:web:2be196ce5aadcb55eb921f",
            measurementId: "G-HD861K8CNG"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e6ed;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #b0b0b0;
            font-size: 14px;
        }

        .admin-badge {
            background: #dc3545;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: bold;
        }

        .calendar-container {
            background: #2d2d2d;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .calendar-header {
            padding: 20px;
            background: #ffd700;
            color: #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-btn {
            background: rgba(26,26,26,0.2);
            border: none;
            color: #1a1a1a;
            font-size: 18px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-btn:hover {
            background: rgba(26,26,26,0.3);
        }

        .month-year {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #ff6b6b;
            color: white;
        }

        .btn-primary:hover {
            background: #ff5252;
        }

        .header .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .header .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-secondary {
            background: rgba(26,26,26,0.2);
            color: #1a1a1a;
        }

        .btn-secondary:hover {
            background: rgba(26,26,26,0.3);
        }

        .btn-auth {
            background: #28a745;
            color: white;
        }

        .btn-auth:hover {
            background: #218838;
        }

        .btn-logout {
            background: #6c757d;
            color: white;
            font-size: 12px;
            padding: 6px 12px;
        }

        .btn-logout:hover {
            background: #5a6268;
        }

        .btn-cancel {
            background: #666;
            color: white;
        }

        .btn-cancel:hover {
            background: #777;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day-header {
            background: #3a3a3a;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            color: #b0b0b0;
            font-size: 14px;
            text-transform: uppercase;
        }

        .calendar-day {
            min-height: 100px;
            border: 1px solid #404040;
            padding: 10px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            flex-direction: column;
            background: #2d2d2d;
        }

        .calendar-day:hover {
            background: #404040;
        }

        .calendar-day.other-month {
            color: #666;
            background: #1f1f1f;
        }

        .calendar-day.today {
            background: #ffd700;
            color: #1a1a1a;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .events {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .event {
            background: #ffd700;
            color: #1a1a1a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
            font-weight: 500;
        }

        .event:hover {
            background: #e6c200;
        }

        .admin-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            display: none;
        }

        .admin-controls.show {
            display: block;
        }

        .admin-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            opacity: 0.8;
        }

        .admin-delete-btn:hover {
            opacity: 1;
            background: #c82333;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #2d2d2d;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #404040;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #e0e6ed;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #b0b0b0;
        }

        .close-btn:hover {
            color: #ffd700;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #404040;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e0e6ed;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #404040;
            border-radius: 8px;
            font-size: 14px;
            background: #3a3a3a;
            color: #e0e6ed;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #ffd700;
        }

        .form-input.error, .form-select.error, .form-textarea.error {
            border-color: #ff6b6b;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .error-message {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .upload-area {
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #3a3a3a;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #ffd700;
        }

        .upload-area.has-image {
            padding: 0;
            border: none;
            background: transparent;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }

        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .preview-info {
            line-height: 1.8;
        }

        .preview-field {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .preview-label {
            font-weight: 600;
            min-width: 120px;
            color: #e0e6ed;
        }

        /* Auth Modal Styles */
        .auth-modal .modal-content {
            max-width: 400px;
        }

        .auth-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .toggle-link {
            color: #ffd700;
            cursor: pointer;
            text-decoration: underline;
        }

        .toggle-link:hover {
            color: #e6c200;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #888;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #404040;
        }

        .divider span {
            background: #2d2d2d;
            padding: 0 15px;
        }

        .google-btn {
            width: 100%;
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .google-btn:hover {
            background: #357ae8;
        }

        .onboarding-modal .modal-content {
            max-width: 600px;
        }

        .terms-section {
            margin-bottom: 20px;
        }

        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .terms-checkbox input[type="checkbox"] {
            margin-top: 3px;
            min-width: 16px;
        }

        .terms-text {
            font-size: 13px;
            color: #b0b0b0;
            line-height: 1.4;
        }

        /* Sidebar */
        .sidebar {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: #e0e6ed;
        }

        .search-container {
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #404040;
            border-radius: 8px;
            font-size: 14px;
            background: #3a3a3a;
            color: #e0e6ed;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .search-input::placeholder {
            color: #888;
        }

        .upcoming-event {
            padding: 12px;
            border-left: 4px solid #ffd700;
            background: #3a3a3a;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .upcoming-event:hover {
            background: #404040;
        }

        .upcoming-event-content {
            flex: 1;
        }

        .upcoming-event-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #e0e6ed;
        }

        .upcoming-event-date {
            font-size: 12px;
            color: #ffd700;
        }

        .upcoming-event-creator {
            font-size: 11px;
            color: #888;
        }

        .upcoming-event-image {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .no-events {
            text-align: center;
            padding: 20px;
            color: #888;
        }

        .success-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .success-toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .error-toast {
            background: #dc3545;
        }

        /* Footer styles */
        .footer {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #b0b0b0;
            text-decoration: none;
            font-size: 13px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: color 0.3s;
        }

        .footer-link:hover {
            color: #ffd700;
            text-decoration: underline;
        }

        .footer-text {
            color: #888;
            font-size: 12px;
            margin-top: 10px;
        }

        /* MOBILE OPTIMIZATIONS */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 15px;
            }

            .logo {
                font-size: 18px;
                line-height: 1.3;
            }

            .header-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            .user-info {
                order: -1;
                justify-content: center;
                flex-direction: column;
                gap: 8px;
            }

            .calendar-container {
                margin-bottom: 15px;
            }

            .calendar-header {
                padding: 12px 15px;
                flex-direction: column;
                gap: 12px;
            }

            .calendar-nav {
                justify-content: space-between;
                width: 100%;
                align-items: center;
            }

            .month-year {
                font-size: 18px;
                order: 2;
                flex: 1;
                text-align: center;
                margin: 0 15px;
            }

            .nav-btn {
                padding: 12px 16px;
                font-size: 18px;
                min-width: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .nav-btn:first-child {
                order: 1;
            }

            .nav-btn:last-child {
                order: 3;
            }

            .controls {
                order: 4;
                width: 100%;
                justify-content: center;
            }

            .controls .btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .calendar-grid {
                font-size: 13px;
            }

            .day-header {
                padding: 8px 4px;
                font-size: 11px;
            }

            .calendar-day {
                min-height: 70px;
                padding: 6px;
                font-size: 13px;
            }

            .day-number {
                font-size: 13px;
                margin-bottom: 4px;
                font-weight: 600;
            }

            .event {
                font-size: 10px;
                padding: 2px 4px;
                margin-bottom: 1px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .sidebar {
                margin-top: 15px;
                padding: 15px;
            }

            .upcoming-event {
                padding: 10px;
                flex-direction: column;
                gap: 8px;
            }

            .upcoming-event-image {
                width: 100%;
                height: 120px;
                align-self: center;
            }

            .modal-content {
                width: 95%;
                margin: 10px;
                max-height: 85vh;
            }

            .modal-header {
                padding: 15px;
            }

            .modal-body {
                padding: 15px;
                max-height: calc(85vh - 120px);
                overflow-y: auto;
            }

            .modal-footer {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 14px;
                width: 100%;
            }

            .header .btn {
                width: auto;
                padding: 8px 16px;
                font-size: 13px;
            }

            .success-toast {
                right: 10px;
                left: 10px;
                top: 10px;
            }

            .footer {
                padding: 15px;
                margin-top: 15px;
            }

            .footer-links {
                gap: 15px;
            }

            .footer-link {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 16px;
            }

            .calendar-header {
                padding: 10px;
            }

            .calendar-nav {
                gap: 10px;
            }

            .month-year {
                font-size: 16px;
                margin: 0 10px;
            }

            .nav-btn {
                padding: 10px 12px;
                font-size: 16px;
                min-width: 44px;
            }

            .calendar-day {
                min-height: 60px;
                padding: 4px;
            }

            .day-number {
                font-size: 12px;
                margin-bottom: 3px;
            }

            .event {
                font-size: 9px;
                padding: 1px 3px;
            }

            .day-header {
                padding: 6px 2px;
                font-size: 10px;
            }

            .footer-links {
                flex-direction: column;
                gap: 10px;
            }

            .upcoming-event-title {
                font-size: 14px;
            }

            .upcoming-event-date {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">The Black Experience Community Calendar</div>
            <div class="header-controls">
                <div class="user-info" id="userInfo" style="display: none;">
                    <span id="userName"></span>
                    <button class="btn btn-logout" onclick="logout()">Logout</button>
                </div>
                <button class="btn btn-secondary" onclick="showHelp()">Help</button>
                <button class="btn btn-auth" id="authButton" onclick="handleAuthButtonClick()">Log in to post</button>
            </div>
        </div>

 <!-- Calendar -->
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="previousMonth()">‚Äπ</button>
                    <div class="month-year" id="monthYear">September 2025</div>
                    <button class="nav-btn" onclick="nextMonth()">‚Ä∫</button>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="goToToday()">Today</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <!-- Upcoming Events -->
        <div class="sidebar">
            <h3>Upcoming Events</h3>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search upcoming events...">
            </div>
            <div id="upcomingEvents">
                <div class="no-events">
                    <p>üìÖ No upcoming events</p>
                    <p style="font-size: 12px;">Be the first to create an event!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="authModalTitle">Log In</div>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-toggle">
                    <span id="authToggleText">Don't have an account?</span>
                    <span class="toggle-link" id="authToggleLink" onclick="toggleAuthMode()">Sign up</span>
                </div>
                
                <form id="authForm" onsubmit="handleAuthSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="authEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="authPassword" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="authSubmitBtn">Log In</button>
                </form>
                
                <div class="divider">
                    <span>or</span>
                </div>
                
                <button class="google-btn" onclick="signInWithGoogle()">
                    <span>üîê</span>
                    Continue with Google
                </button>
            </div>
        </div>
    </div>
        function closeEventModal() {
            document.getElementById('eventModal').classList.remove('show');
            clearEventForm();
            editingEventId = null;
        }

    <!-- Onboarding Modal with Terms -->
    <div id="onboardingModal" class="modal onboarding-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Complete Your Profile</div>
            </div>
            <div class="modal-body">
                <form id="onboardingForm" onsubmit="handleOnboardingSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="fullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" class="form-input" id="phoneNumber" placeholder="(555) 123-4567" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contact Email *</label>
                        <input type="email" class="form-input" id="contactEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company Name *</label>
                        <input type="text" class="form-input" id="companyName" placeholder="Your company or organization" required>
                    </div>
        function clearEventForm() {
            document.getElementById('eventTitle').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('location').value = '';
            document.getElementById('description').value = '';
            document.getElementById('createdByName').value = '';
            
            resetImageUpload();
            
            const errorElements = document.querySelectorAll('.error-message');
            const inputElements = document.querySelectorAll('.form-input, .form-select, .form-textarea');
            
            errorElements.forEach(error => error.classList.remove('show'));
            inputElements.forEach(input => input.classList.remove('error'));
        }

                    <!-- Terms and Disclaimer Section -->
                    <div style="background: #3a3a3a; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ffd700;">
                        <h4 style="color: #ffd700; margin-bottom: 15px;">Terms & Community Guidelines</h4>
                        
                        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; font-size: 13px; line-height: 1.5;">
                            <p style="margin-bottom: 10px;"><strong>By using The Black Experience Community Calendar, you agree to:</strong></p>
                            
                            <ul style="margin-bottom: 15px; padding-left: 20px;">
                                <li>Post only community-appropriate, family-friendly events</li>
                                <li>Provide accurate event information</li>
                                <li>Respect community guidelines and avoid offensive content</li>
                                <li>Take responsibility for your own event attendance and safety</li>
                            </ul>
                            
                            <p style="margin-bottom: 10px;"><strong>Important Disclaimer:</strong></p>
                            <p style="margin-bottom: 10px;">The Black Experience Community Calendar and BXE LLC are not responsible for events posted by community members, event cancellations, changes, or any damages, injuries, or losses related to attended events. You attend events at your own risk and are responsible for verifying event details.</p>
                            
                            <p style="margin-bottom: 10px;"><strong>We reserve the right to:</strong></p>
                            <ul style="margin-bottom: 10px; padding-left: 20px;">
                                <li>Remove content that violates our guidelines</li>
                                <li>Suspend accounts for repeated violations</li>
                                <li>Moderate all posted content</li>
                            </ul>
                        </div>
                        
                        <div class="terms-checkbox">
                            <input type="checkbox" id="termsCheckbox" required>
                            <label for="termsCheckbox" class="terms-text">
                                <strong>I have read and agree to the above terms, community guidelines, and disclaimer.</strong>
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="onboardingSubmitBtn">
                        Complete Setup
                    </button>
                </form>
            </div>
        </div>
    </div>
        // Rate limiting variables
        const RATE_LIMITS = {
            events_per_hour: 5,
            events_per_day: 20,
            events_per_week: 50
        };

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Create Event</div>
                <button class="close-btn" onclick="closeEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Event Title *</label>
                    <input type="text" class="form-input" id="eventTitle" placeholder="Enter event title" required>
                    <div class="error-message" id="titleError">Please enter an event title</div>
                </div>
        // Check rate limits before allowing event creation
        async function checkRateLimits(userId) {
            try {
                const now = new Date();
                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
                const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

                // Count recent events by this user
                const recentEvents = await db.collection('events')
                    .where('created_by_uid', '==', userId)
                    .where('created_at', '>=', oneWeekAgo)
                    .get();

                let eventsLastHour = 0;
                let eventsLastDay = 0;
                let eventsLastWeek = recentEvents.size;

                recentEvents.forEach(doc => {
                    const eventTime = doc.data().created_at.toDate();
                    if (eventTime >= oneHourAgo) eventsLastHour++;
                    if (eventTime >= oneDayAgo) eventsLastDay++;
                });

                // Check limits
                if (eventsLastHour >= RATE_LIMITS.events_per_hour) {
                    throw new Error(`Rate limit exceeded: Maximum ${RATE_LIMITS.events_per_hour} events per hour. Please wait before creating another event.`);
                }
                if (eventsLastDay >= RATE_LIMITS.events_per_day) {
                    throw new Error(`Rate limit exceeded: Maximum ${RATE_LIMITS.events_per_day} events per day. Please try again tomorrow.`);
                }
                if (eventsLastWeek >= RATE_LIMITS.events_per_week) {
                    throw new Error(`Rate limit exceeded: Maximum ${RATE_LIMITS.events_per_week} events per week. Please try again later.`);
                }

                return true;
            } catch (error) {
                throw error;
            }
        }

        async function saveEvent() {
            if (!currentUser || !userProfile) {
                showToast('You must be logged in to create events', 'error');
                return;
            }

            if (!validateEventForm()) {
                return;
            }

            const saveBtn = document.getElementById('saveEventBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = editingEventId ? 'Updating...' : 'Creating...';

            try {
                // Check rate limits only for new events, not edits
                if (!editingEventId) {
                    await checkRateLimits(currentUser.uid);
                }

                const eventData = {
                    title: document.getElementById('eventTitle').value.trim(),
                    start: document.getElementById('startDate').value,
                    end: document.getElementById('endDate').value,
                    location: document.getElementById('location').value.trim(),
                    description: document.getElementById('description').value.trim(),
                    image_url: uploadedImage || null,
                    updated_at: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (!editingEventId) {
                    eventData.created_by_uid = currentUser.uid;
                    eventData.created_by_name = userProfile.full_name;
                    eventData.status = 'public';
                    eventData.created_at = firebase.firestore.FieldValue.serverTimestamp();
                }

                if (editingEventId) {
                    await db.collection('events').doc(editingEventId).update(eventData);
                    showToast('Event updated successfully!');
                } else {
                    await db.collection('events').add(eventData);
                    showToast('Event created successfully!');
                }

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date & Time *</label>
                        <input type="datetime-local" class="form-input" id="startDate" required>
                        <div class="error-message" id="startError">Please select a start date</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date & Time *</label>
                        <input type="datetime-local" class="form-input" id="endDate" required>
                        <div class="error-message" id="endError">Please select an end date</div>
                    </div>
                </div>
                loadEventsFromFirebase();
                closeEventModal();
            } catch (error) {
                console.error('Error saving event:', error);
                if (error.message.includes('Rate limit exceeded')) {
                    showToast(error.message, 'error');
                } else {
                    showToast('Failed to save event. Please try again.', 'error');
                }
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = editingEventId ? 'Update Event' : 'Create Event';
            }
        }

                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="location" placeholder="Event location">
                </div>
        function validateEventForm() {
            let isValid = true;
            
            const title = document.getElementById('eventTitle').value.trim();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="description" placeholder="Event details"></textarea>
                </div>
            const errorElements = document.querySelectorAll('.error-message');
            const inputElements = document.querySelectorAll('.form-input');
            
            errorElements.forEach(error => error.classList.remove('show'));
            inputElements.forEach(input => input.classList.remove('error'));

                <div class="form-group">
                    <label class="form-label">Created by</label>
                    <input type="text" class="form-input" id="createdByName" readonly style="background: #222; color: #888;">
                </div>
            if (!title) {
                showFieldError('eventTitle', 'titleError', 'Please enter an event title');
                isValid = false;
            }

                <div class="form-group">
                    <label class="form-label">Event Image</label>
                    <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
                        <div id="uploadText">
                            <div style="font-size: 24px; margin-bottom: 8px;">üì∑</div>
                            <div>Click to upload image or drag and drop</div>
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">PNG, JPG up to 5MB</div>
                        </div>
                        <div id="imagePreview" style="display: none;"></div>
                    </div>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeEventModal()">Cancel</button>
                <button class="btn btn-primary" id="saveEventBtn" onclick="saveEvent()">Create Event</button>
            </div>
        </div>
    </div>
            if (!startDate) {
                showFieldError('startDate', 'startError', 'Please select a start date');
                isValid = false;
            }

    <!-- Event Preview Modal -->
    <div id="eventPreviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="previewEventTitle">Event Details</div>
                <button class="close-btn" onclick="closeEventPreviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="previewEventImage" style="margin-bottom: 20px;"></div>
            if (!endDate) {
                showFieldError('endDate', 'endError', 'Please select an end date');
                isValid = false;
            }

            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);

                <div class="preview-info">
                    <div class="preview-field">
                        <span class="preview-label">üìÖ Start:</span>
                        <span id="previewEventStart"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üèÅ End:</span>
                        <span id="previewEventEnd"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üìç Location:</span>
                        <span id="previewEventLocation"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üìù Description:</span>
                        <span id="previewEventDescription"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üë§ Created by:</span>
                        <span id="previewEventCreator"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div id="eventOwnerControls" style="display: none; gap: 10px;">
                    <button class="btn btn-secondary" onclick="editCurrentEvent()">Edit Event</button>
                    <button class="btn btn-danger" onclick="deleteCurrentEvent()">Delete Event</button>
                </div>
                <button class="btn btn-cancel" onclick="closeEventPreviewModal()">Close</button>
            </div>
        </div>
    </div>
                if (end <= start) {
                    showFieldError('endDate', 'endError', 'End date must be after start date');
                    isValid = false;
                }
            }

    <!-- Terms of Service Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Terms of Service</div>
                <button class="close-btn" onclick="closeTermsModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <h4 style="color: #ffd700; margin-bottom: 15px;">Acceptance of Terms</h4>
                <p style="margin-bottom: 15px;">By using The Black Experience Community Calendar, you agree to these Terms of Service and all applicable laws and regulations.</p>
            return isValid;
        }

        function showFieldError(fieldId, errorId, message) {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(errorId);
            
            field.classList.add('error');
            error.textContent = message;
            error.classList.add('show');
        }

        // Admin delete event function
        function adminDeleteEvent(eventId, eventTitle) {
            if (!isAdmin) {
                showToast('Access denied. Admin privileges required.', 'error');
                return;
            }
            
            const reason = prompt(`Admin Action: Delete event "${eventTitle}"?\n\nOptional: Enter reason for deletion (will be logged):`);
            
            if (reason !== null) {
                deleteEventWithReason(eventId, eventTitle, reason || 'No reason provided');
            }
        }

        async function deleteEventWithReason(eventId, eventTitle, reason) {
            try {
                const event = events.find(e => e.id === eventId);

                <h4 style="color: #ffd700; margin-bottom: 15px;">Event Posting Guidelines</h4>
                <ul style="margin-bottom: 15px; padding-left: 20px;">
                    <li>Events must be community-appropriate and family-friendly</li>
                    <li>No hate speech, discrimination, or offensive content</li>
                    <li>No illegal activities or inappropriate solicitation</li>
                    <li>Commercial events must benefit the community</li>
                    <li>Accurate information required - false events will be removed</li>
                </ul>
                await db.collection('admin_actions').add({
                    action: 'delete_event',
                    event_id: eventId,
                    event_title: eventTitle,
                    admin_email: currentUser.email,
                    admin_name: userProfile.full_name,
                    reason: reason,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                await db.collection('events').doc(eventId).delete();

                <h4 style="color: #ffd700; margin-bottom: 15px;">Liability Disclaimer</h4>
                <p style="margin-bottom: 15px;"><strong>The Black Experience Community Calendar and BXE
                if (event && event.image_url) {
                    try {
                        const imageRef = storage.refFromURL(event.image_url);
                        await imageRef.delete();
                    } catch (imageError) {
                        console.warn('Could not delete image:', imageError);
                    }
                }
                
                showToast(`Event "${eventTitle}" deleted by admin`);
                loadEventsFromFirebase();
            } catch (error) {
                console.error('Error deleting event:', error);
                showToast('Failed to delete event. Please try again.', 'error');
            }
        }

        function formatDateTimeLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        function showToast(message, type = 'success') {
            const existing = document.querySelector('.success-toast');
            if (existing) {
                existing.remove();
            }

            const toast = document.createElement('div');
            toast.className = `success-toast ${type === 'error' ? 'error-toast' : ''}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        function showHelp() {
            alert('The Black Experience Community Calendar Help:\n\n' +
                'Authentication:\n' +
                '‚Ä¢ Click "Log in to post" to create an account or sign in\n' +
                '‚Ä¢ Complete your profile setup after first login\n' +
                '‚Ä¢ Only authenticated users can create events\n\n' +
                'Creating Events:\n' +
                '‚Ä¢ Click "Post an event" when logged in\n' +
                '‚Ä¢ Or click on any calendar date\n' +
                '‚Ä¢ Fill in required fields and save\n\n' +
                'Viewing Events:\n' +
                '‚Ä¢ Click any event to see details\n' +
                '‚Ä¢ View upcoming events in the sidebar\n' +
                '‚Ä¢ Use search to find specific events\n\n' +
                'Navigation:\n' +
                '‚Ä¢ Use arrow buttons to navigate months\n' +
                '‚Ä¢ "Today" button returns to current date\n\n' +
                'Need help? Contact support!');
        }
    </script>
</body>
</html>
