<!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Create Event</div>
                <button class="close-btn" onclick="closeEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Event Title *</label>
                    <input type="text" class="form-input" id="eventTitle" placeholder="Enter event title" required>
                    <div class="error-message" id="titleError">Please enter an event title</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date & Time *</label>
                        <input type="datetime-local" class="form-input" id="startDate" required>
                        <div class="error-message" id="startError">Please select a start date</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date & Time *</label>
                        <input type="datetime-local" class="form-input" id="endDate" required>
                        <div class="error-message" id="endError">Please select an end date</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="location" placeholder="Event location">
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="description" placeholder="Event details"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Created by</label>
                    <input type="text" class="form-input" id="createdByName" readonly style="background: #222; color: #888;">
                </div>

                <div class="form-group">
                    <label class="form-label">Event Image</label>
                    <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
                        <div id="uploadText">
                            <div style="font-size: 24px; margin-bottom: 8px;">üì∑</div>
                            <div>Click to upload image or drag and drop</div>
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">PNG, JPG up to 5MB</div>
                        </div>
                        <div id="imagePreview" style="display: none;"></div>
                    </div>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeEventModal()">Cancel</button>
                <button class="btn btn-primary" id="saveEventBtn" onclick="saveEvent()">Create Event</button>
            </div>
        </div>
    </div>

    <!-- Event Preview Modal -->
    <div id="eventPreviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="previewEventTitle">Event Details</div>
                <button class="close-btn" onclick="closeEventPreviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="previewEventImage" style="margin-bottom: 20px;"></div>
                
                <div class="preview-info">
                    <div class="preview-field">
                        <span class="preview-label">üìÖ Start:</span>
                        <span id="previewEventStart"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üèÅ End:</span>
                        <span id="previewEventEnd"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üìç Location:</span>
                        <span id="previewEventLocation"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üìù Description:</span>
                        <span id="previewEventDescription"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üë§ Created by:</span>
                        <span id="previewEventCreator"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div id="eventOwnerControls" style="display: none; gap: 10px;">
                    <button class="btn btn-secondary" onclick="editCurrentEvent()">Edit Event</button>
                    <button class="btn btn-danger" onclick="deleteCurrentEvent()">Delete Event</button>
                </div>
                <button class="btn btn-cancel" onclick="closeEventPreviewModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="text-align: center; padding: 20px 0; color: #666; font-size: 11px; border-top: 1px solid #404040; margin-top: 40px;">
        <p style="margin: 0;">¬© 2025 The Black Experience Community Calendar | BXE LLC</p>
    </footer>

    <script>
        // Global variables
        let events = [];
        let currentDate = new Date();
        let today = new Date();
        let currentUser = null;
        let userProfile = null;
        let isSignUpMode = false;
        let currentSearchQuery = '';
        let isAdmin = false;
        let uploadedImage = null;
        let currentEventId = null;
        let editingEventId = null;

        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        const ADMIN_EMAILS = [
            '97franchise@gmail.com',
            'afgarner@bxellc.com',
            'craigdbarnes@gmail.com'
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupRealTimeDate();
            setupAuthStateListener();
            setupEventListeners();
            setupImageUpload();
            setupSearch();
            loadEventsFromFirebase();
        });

        function setupRealTimeDate() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);
            
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    updateCurrentTime();
                }
            });
        }

        function updateCurrentTime() {
            const now = new Date();
            const centralTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Chicago"}));
            
            const previousDay = today.getDate();
            today = centralTime;
            
            if (today.getDate() !== previousDay && 
                currentDate.getMonth() === today.getMonth() && 
                currentDate.getFullYear() === today.getFullYear()) {
                renderCalendar();
            }
            
            if (!currentDate || Math.abs(currentDate - now) > 24 * 60 * 60 * 1000) {
                currentDate = new Date(today);
            }
        }

        function setupAuthStateListener() {
            auth.onAuthStateChanged(async (user) => {
                currentUser = user;
                
                if (user) {
                    isAdmin = ADMIN_EMAILS.includes(user.email);
                    await checkUserProfile();
                    updateAuthUI(true);
                } else {
                    userProfile = null;
                    isAdmin = false;
                    updateAuthUI(false);
                }
                
                renderCalendar();
                updateUpcomingEvents();
            });
        }

        async function checkUserProfile() {
            if (!currentUser) return;
            
            try {
                const profileDoc = await db.collection('profiles').doc(currentUser.uid).get();
                
                if (profileDoc.exists) {
                    userProfile = profileDoc.data();
                    updateAuthButton('authenticated');
                } else {
                    userProfile = null;
                    updateAuthButton('needs_onboarding');
                }
            } catch (error) {
                console.error('Error checking user profile:', error);
                userProfile = null;
                updateAuthButton('needs_onboarding');
            }
        }

        function updateAuthUI(isAuthenticated) {
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            
            if (isAuthenticated && userProfile) {
                userInfo.style.display = 'flex';
                userName.innerHTML = userProfile.full_name + (isAdmin ? '<span class="admin-badge">ADMIN</span>' : '');
            } else {
                userInfo.style.display = 'none';
            }
        }

        function updateAuthButton(state) {
            const authButton = document.getElementById('authButton');
            
            switch (state) {
                case 'unauthenticated':
                    authButton.textContent = 'Log in to post';
                    authButton.className = 'btn btn-auth';
                    break;
                case 'needs_onboarding':
                    authButton.textContent = 'Finish setup';
                    authButton.className = 'btn btn-primary';
                    break;
                case 'authenticated':
                    authButton.textContent = 'Post an event';
                    authButton.className = 'btn btn-primary';
                    break;
            }
        }

        function handleAuthButtonClick() {
            if (!currentUser) {
                openAuthModal();
            } else if (!userProfile) {
                openOnboardingModal();
            } else {
                openEventModal();
            }
        }

        function openAuthModal() {
            document.getElementById('authModal').classList.add('show');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('show');
            document.getElementById('authForm').reset();
        }

        function toggleAuthMode() {
            isSignUpMode = !isSignUpMode;
            
            const title = document.getElementById('authModalTitle');
            const toggleText = document.getElementById('authToggleText');
            const toggleLink = document.getElementById('authToggleLink');
            const submitBtn = document.getElementById('authSubmitBtn');
            
            if (isSignUpMode) {
                title.textContent = 'Sign Up';
                toggleText.textContent = 'Already have an account?';
                toggleLink.textContent = 'Log in';
                submitBtn.textContent = 'Sign Up';
            } else {
                title.textContent = 'Log In';
                toggleText.textContent = "Don't have an account?";
                toggleLink.textContent = 'Sign up';
                submitBtn.textContent = 'Log In';
            }
        }

        async function handleAuthSubmit(event) {
            event.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const submitBtn = document.getElementById('authSubmitBtn');
            
            submitBtn.disabled = true;
            submitBtn.textContent = isSignUpMode ? 'Signing up...' : 'Logging in...';
            
            try {
                if (isSignUpMode) {
                    await auth.createUserWithEmailAndPassword(email, password);
                } else {
                    await auth.signInWithEmailAndPassword(email, password);
                }
                
                closeAuthModal();
                showToast(isSignUpMode ? 'Account created successfully!' : 'Logged in successfully!');
            } catch (error) {
                console.error('Auth error:', error);
                showToast(error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = isSignUpMode ? 'Sign Up' : 'Log In';
            }
        }

        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            try {
                await auth.signInWithPopup(provider);
                closeAuthModal();
                showToast('Logged in with Google successfully!');
            } catch (error) {
                console.error('Google sign-in error:', error);
                showToast(error.message, 'error');
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                showToast('Logged out successfully!');
                updateAuthButton('unauthenticated');
            } catch (error) {
                console.error('Logout error:', error);
                showToast(error.message, 'error');
            }
        }

        function openOnboardingModal() {
            document.getElementById('onboardingModal').classList.add('show');
            
            if (currentUser) {
                if (currentUser.displayName) {
                    document.getElementById('fullName').value = currentUser.displayName;
                }
                if (currentUser.email) {
                    document.getElementById('contactEmail').value = currentUser.email;
                }
            }
        }

        function closeOnboardingModal() {
            document.getElementById('onboardingModal').classList.remove('show');
            document.getElementById('onboardingForm').reset();
        }

        async function handleOnboardingSubmit(event) {
            event.preventDefault();
            
            if (!currentUser) return;
            
            const submitBtn = document.getElementById('onboardingSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating profile...';
            
            const profileData = {
                uid: currentUser.uid,
                full_name: document.getElementById('fullName').value.trim(),
                phone_number: document.getElementById('phoneNumber').value.trim(),
                contact_email: document.getElementById('contactEmail').value.trim(),
                company_name: document.getElementById('companyName').value.trim(),
                created_at: firebase.firestore.FieldValue.serverTimestamp(),
                updated_at: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('profiles').doc(currentUser.uid).set(profileData);
                userProfile = profileData;
                
                closeOnboardingModal();
                updateAuthButton('authenticated');
                updateAuthUI(true);
                showToast('Profile created successfully!');
            } catch (error) {
                console.error('Error creating profile:', error);
                showToast('Failed to create profile. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Complete Setup';
            }
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                currentSearchQuery = e.target.value.trim();
                updateUpcomingEvents();
            });
        }

        function setupEventListeners() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    if (e.target.id === 'authModal') closeAuthModal();
                    if (e.target.id === 'onboardingModal') closeOnboardingModal();
                    if (e.target.id === 'eventModal') closeEventModal();
                    if (e.target.id === 'eventPreviewModal') closeEventPreviewModal();
                }
            });
        }

        function setupImageUpload() {
            const imageUpload = document.getElementById('imageUpload');
            if (imageUpload) {
                imageUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    if (!file.type.startsWith('image/')) {
                        showToast('Please select an image file', 'error');
                        return;
                    }

                    if (file.size > 5 * 1024 * 1024) {
                        showToast('Image must be smaller than 5MB', 'error');
                        return;
                    }

                    uploadImageToStorage(file);
                });
            }
        }

        async function uploadImageToStorage(file) {
            try {
                const uploadText = document.getElementById('uploadText');
                uploadText.innerHTML = '<div style="color: #ffd700;">Uploading image...</div>';
                
                const timestamp = Date.now();
                const fileName = `event-images/${timestamp}_${file.name}`;
                const storageRef = storage.ref(fileName);
                
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                uploadedImage = downloadURL;
                showImagePreview(downloadURL);
                showToast('Image uploaded successfully!');
            } catch (error) {
                console.error('Error uploading image:', error);
                showToast('Failed to upload image. Please try again.', 'error');
                resetImageUpload();
            }
        }

        function showImagePreview(imageSrc) {
            const uploadArea = document.querySelector('.upload-area');
            const uploadText = document.getElementById('uploadText');
            const imagePreview = document.getElementById('imagePreview');

            if (uploadArea && uploadText && imagePreview) {
                uploadArea.classList.add('has-image');
                uploadText.style.display = 'none';
                imagePreview.style.display = 'block';
                imagePreview.innerHTML = `
                    <img src="${imageSrc}" class="image-preview" alt="Event image">
                    <div style="padding: 10px; color: #28a745; font-size: 14px;">‚úì Image ready</div>
                `;
            }
        }

        function resetImageUpload() {
            const uploadArea = document.querySelector('.upload-area');
            const uploadText = document.getElementById('uploadText');
            const imagePreview = document.getElementById('imagePreview');
            const imageUpload = document.getElementById('imageUpload');

            if (uploadArea) uploadArea.classList.remove('has-image');
            if (uploadText) {
                uploadText.style.display = 'block';
                uploadText.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 8px;">üì∑</div>
                    <div>Click to upload image or drag and drop</div>
                    <div style="font-size: 12px; color: #888; margin-top: 4px;">PNG, JPG up to 5MB</div>
                `;
            }
            if (imagePreview) {
                imagePreview.style.display = 'none';
                imagePreview.innerHTML = '';
            }
            if (imageUpload) imageUpload.value = '';
            uploadedImage = null;
        }

        function loadEventsFromFirebase() {
            db.collection('events')
                .orderBy('start', 'asc')
                .get()
                .then((querySnapshot) => {
                    events = [];
                    querySnapshot.forEach((doc) => {
                        events.push({ id: doc.id, ...doc.data() });
                    });
                    renderCalendar();
                    updateUpcomingEvents();
                })
                .catch((error) => {
                    console.error("Error loading events: ", error);
                    renderCalendar();
                    updateUpcomingEvents();
                });
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('monthYear');
            
            monthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            grid.innerHTML = '';

            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                if (cellDate.getMonth() !== currentDate.getMonth()) {
                    dayCell.classList.add('other-month');
                }
                
                if (isSameDay(cellDate, today)) {
                    dayCell.classList.add('today');
                }

                dayCell.innerHTML = `
                    <div class="day-number">${cellDate.getDate()}</div>
                    <div class="events"></div>
                `;

                if (cellDate.getMonth() === currentDate.getMonth() && currentUser && userProfile) {
                    dayCell.addEventListener('click', function(e) {
                        if (e.target === dayCell || e.target.classList.contains('day-number')) {
                            openEventModal(cellDate);
                        }
                    });
                }

                const dayEvents = getEventsForDay(cellDate);
                const eventsContainer = dayCell.querySelector('.events');
                
                dayEvents.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'event';
                    eventElement.style.position = 'relative';
                    eventElement.textContent = event.title;
                    
                    if (isAdmin) {
                        const adminControls = document.createElement('div');
                        adminControls.className = 'admin-controls';
                        
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'admin-delete-btn';
                        deleteBtn.textContent = '√ó';
                        deleteBtn.title = 'Delete event (Admin)';
                        deleteBtn.onclick = (e) => {
                            e.stopPropagation();
                            adminDeleteEvent(event.id, event.title);
                        };
                        
                        adminControls.appendChild(deleteBtn);
                        eventElement.appendChild(adminControls);
                        
                        eventElement.addEventListener('mouseenter', () => {
                            adminControls.classList.add('show');
                        });
                        eventElement.addEventListener('mouseleave', () => {
                            adminControls.classList.remove('show');
                        });
                    }
                    
                    eventElement.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showEventDetails(event);
                    });

                    eventsContainer.appendChild(eventElement);
                });

                grid.appendChild(dayCell);
            }
        }

        function getEventsForDay(date) {
            return events.filter(event => {
                const eventDate = new Date(event.start);
                return isSameDay(eventDate, date);
            });
        }

        function isSameDay(date1, date2) {
            return date1.getDate() === date2.getDate() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }

        function updateUpcomingEvents() {
            const container = document.getElementById('upcomingEvents');
            const centralTimeNow = new Date(new Date().toLocaleString("en-US", {timeZone: "America/Chicago"}));
            
            let upcomingEvents = events
                .filter(event => new Date(event.start) > centralTimeNow)
                .sort((a, b) => new Date(a.start) - new Date(b.start));

            if (currentSearchQuery) {
                const searchLower = currentSearchQuery.toLowerCase();
                upcomingEvents = upcomingEvents.filter(event => {
                    const title = (event.title || '').toLowerCase();
                    const description = (event.description || '').toLowerCase();
                    const location = (event.location || '').toLowerCase();
                    
                    return title.includes(searchLower) ||
                           description.includes(searchLower) ||
                           location.includes(searchLower);
                });
                
                if (upcomingEvents.length === 0) {
                    container.innerHTML = `
                        <div class="no-events">
                            <p>No events found</p>
                            <p style="font-size: 12px;">Try a different search term</p>
                        </div>
                    `;
                    return;
                }
            } else {
                upcomingEvents = upcomingEvents.slice(0, 5);
            }

            if (upcomingEvents.length === 0) {
                container.innerHTML = `
                    <div class="no-events">
                        <p>No upcoming events</p>
                        <p style="font-size: 12px;">Be the first to create an event!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = upcomingEvents.map(event => {
                const adminDeleteBtn = isAdmin ? 
                    `<button class="admin-delete-btn" onclick="event.stopPropagation(); adminDeleteEvent('${event.id}', '${event.title.replace(/'/g, "\\'")}');" title="Delete event (Admin)" style="position: absolute; top: 5px; right: 5px;">√ó</button>` : '';
                
                const imageHtml = event.image_url ? 
                    `<img src="${event.image_url}" class="upcoming-event-image" alt="${event.title}">` : '';
                
                return `
                    <div class="upcoming-event" onclick="showEventDetails(${JSON.stringify(event).replace(/"/g, '&quot;')})" style="position: relative;">
                        ${adminDeleteBtn}
                        <div class="upcoming-event-content">
                            <div class="upcoming-event-title">${event.title}</div>
                            <div class="upcoming-event-date">${formatEventDate(event.start)}</div>
                            <div class="upcoming-event-creator">by ${event.created_by_name}</div>
                        </div>
                        ${imageHtml}
                    </div>
                `;
            }).join('');
        }

        function formatEventDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'America/Chicago',
                timeZoneName: 'short'
            });
        }

        function showEventDetails(event) {
            currentEventId = event.id;
            
            document.getElementById('eventPreviewModal').classList.add('show');
            document.getElementById('previewEventTitle').textContent = event.title;
            document.getElementById('previewEventStart').textContent = formatEventDate(event.start);
            document.getElementById('previewEventEnd').textContent = formatEventDate(event.end);
            document.getElementById('previewEventLocation').textContent = event.location || 'No location specified';
            document.getElementById('previewEventDescription').textContent = event.description || 'No description provided';
            document.getElementById('previewEventCreator').textContent = event.created_by_name;
            
            const imageContainer = document.getElementById('previewEventImage');
            if (event.image_url) {
                imageContainer.innerHTML = `<img src="${event.image_url}" class="preview-image" alt="Event image">`;
                imageContainer.style.display = 'block';
            } else {
                imageContainer.style.display = 'none';
            }
            
            const ownerControls = document.getElementById('eventOwnerControls');
            if (currentUser && currentUser.uid === event.created_by_uid) {
                ownerControls.style.display = 'flex';
            } else {
                ownerControls.style.display = 'none';
            }
        }

        function closeEventPreviewModal() {
            document.getElementById('eventPreviewModal').classList.remove('show');
            currentEventId = null;
        }

        function editCurrentEvent() {
            if (!currentEventId) return;
            
            const event = events.find(e => e.id === currentEventId);
            if (!event) return;
            
            closeEventPreviewModal();
            openEditEventModal(event);
        }

        function deleteCurrentEvent() {
            if (!currentEventId) return;
            
            const event = events.find(e => e.id === currentEventId);
            if (!event) return;
            
            if (confirm(`Are you sure you want to delete "${event.title}"?`)) {
                deleteEventWithImage(currentEventId, event.image_url);
            }
            closeEventPreviewModal();
        }

        async function deleteEventWithImage(eventId, imageUrl) {
            try {
                await db.collection('events').doc(eventId).delete();
                
                if (imageUrl) {
                    try {
                        const imageRef = storage.refFromURL(imageUrl);
                        await imageRef.delete();
                    } catch (imageError) {
                        console.warn('Could not delete image:', imageError);
                    }
                }
                
                showToast('Event deleted successfully!');
                loadEventsFromFirebase();
            } catch (error) {
                console.error('Error deleting event:', error);
                showToast('Failed to delete event. Please try again.', 'error');
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date(today);
            renderCalendar();
        }

        function openEventModal(selectedDate = null) {
            if (!currentUser || !userProfile) {
                handleAuthButtonClick();
                return;
            }
            
            editingEventId = null;
            document.getElementById('modalTitle').textContent = 'Create Event';
            document.getElementById('saveEventBtn').textContent = 'Create Event';
            
            clearEventForm();
            document.getElementById('createdByName').value = userProfile.full_name;
            
            if (selectedDate) {
                const start = new Date(selectedDate);
                start.setHours(9, 0);
                const end = new Date(selectedDate);
                end.setHours(10, 0);
                
                document.getElementById('startDate').value = formatDateTimeLocal(start);
                document.getElementById('endDate').value = formatDateTimeLocal(end);
            }
            
            document.getElementById('eventModal').classList.add('show');
        }

        function openEditEventModal(event) {
            if (!currentUser || !userProfile) {
                handleAuthButtonClick();
                return;
            }
            
            editingEventId = event.id;
            document.getElementById('modalTitle').textContent = 'Edit Event';
            document.getElementById('saveEventBtn').textContent = 'Update Event';
            
            document.getElementById('eventTitle').value = event.title;
            document.getElementById('startDate').value = event.start;
            <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Black Experience Community Calendar</title>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAQQwmtpr17jHgx73ux6TaaXRJgwPqTTSM",
            authDomain: "bxe-community-calendar.firebaseapp.com",
            projectId: "bxe-community-calendar",
            storageBucket: "bxe-community-calendar.firebasestorage.app",
            messagingSenderId: "99255180622",
            appId: "1:99255180622:web:2be196ce5aadcb55eb921f",
            measurementId: "G-HD861K8CNG"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e6ed;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #b0b0b0;
            font-size: 14px;
        }

        .admin-badge {
            background: #dc3545;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: bold;
        }

        .calendar-container {
            background: #2d2d2d;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .calendar-header {
            padding: 20px;
            background: #ffd700;
            color: #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-btn {
            background: rgba(26,26,26,0.2);
            border: none;
            color: #1a1a1a;
            font-size: 18px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-btn:hover {
            background: rgba(26,26,26,0.3);
        }

        .month-year {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #ff6b6b;
            color: white;
        }

        .btn-primary:hover {
            background: #ff5252;
        }

        .header .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .header .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-secondary {
            background: rgba(26,26,26,0.2);
            color: #1a1a1a;
        }

        .btn-secondary:hover {
            background: rgba(26,26,26,0.3);
        }

        .btn-auth {
            background: #28a745;
            color: white;
        }

        .btn-auth:hover {
            background: #218838;
        }

        .btn-logout {
            background: #6c757d;
            color: white;
            font-size: 12px;
            padding: 6px 12px;
        }

        .btn-logout:hover {
            background: #5a6268;
        }

        .btn-cancel {
            background: #666;
            color: white;
        }

        .btn-cancel:hover {
            background: #777;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day-header {
            background: #3a3a3a;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            color: #b0b0b0;
            font-size: 14px;
            text-transform: uppercase;
        }

        .calendar-day {
            min-height: 100px;
            border: 1px solid #404040;
            padding: 10px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            flex-direction: column;
            background: #2d2d2d;
        }

        .calendar-day:hover {
            background: #404040;
        }

        .calendar-day.other-month {
            color: #666;
            background: #1f1f1f;
        }

        .calendar-day.today {
            background: #ffd700;
            color: #1a1a1a;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .events {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .event {
            background: #ffd700;
            color: #1a1a1a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
            font-weight: 500;
        }

        .event:hover {
            background: #e6c200;
        }

        .admin-controls {
            position: absolute;
            top: 2px;
            right: 2px;
            display: none;
        }

        .admin-controls.show {
            display: block;
        }

        .admin-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            opacity: 0.8;
        }

        .admin-delete-btn:hover {
            opacity: 1;
            background: #c82333;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #2d2d2d;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #404040;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #e0e6ed;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #b0b0b0;
        }

        .close-btn:hover {
            color: #ffd700;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #404040;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e0e6ed;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #404040;
            border-radius: 8px;
            font-size: 14px;
            background: #3a3a3a;
            color: #e0e6ed;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #ffd700;
        }

        .form-input.error, .form-select.error, .form-textarea.error {
            border-color: #ff6b6b;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .error-message {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .upload-area {
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #3a3a3a;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #ffd700;
        }

        .upload-area.has-image {
            padding: 0;
            border: none;
            background: transparent;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }

        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .preview-info {
            line-height: 1.8;
        }

        .preview-field {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .preview-label {
            font-weight: 600;
            min-width: 120px;
            color: #e0e6ed;
        }

        /* Auth Modal Styles */
        .auth-modal .modal-content {
            max-width: 400px;
        }

        .auth-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .toggle-link {
            color: #ffd700;
            cursor: pointer;
            text-decoration: underline;
        }

        .toggle-link:hover {
            color: #e6c200;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #888;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #404040;
        }

        .divider span {
            background: #2d2d2d;
            padding: 0 15px;
        }

        .google-btn {
            width: 100%;
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .google-btn:hover {
            background: #357ae8;
        }

        .onboarding-modal .modal-content {
            max-width: 500px;
        }

        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-top: 15px;
        }

        .terms-checkbox input[type="checkbox"] {
            margin-top: 3px;
        }

        .terms-text {
            font-size: 13px;
            color: #b0b0b0;
            line-height: 1.4;
        }

        /* Sidebar */
        .sidebar {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: #e0e6ed;
        }

        .search-container {
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #404040;
            border-radius: 8px;
            font-size: 14px;
            background: #3a3a3a;
            color: #e0e6ed;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .search-input::placeholder {
            color: #888;
        }

        .upcoming-event {
            padding: 12px;
            border-left: 4px solid #ffd700;
            background: #3a3a3a;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .upcoming-event:hover {
            background: #404040;
        }

        .upcoming-event-content {
            flex: 1;
        }

        .upcoming-event-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #e0e6ed;
        }

        .upcoming-event-date {
            font-size: 12px;
            color: #ffd700;
        }

        .upcoming-event-creator {
            font-size: 11px;
            color: #888;
        }

        .upcoming-event-image {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .no-events {
            text-align: center;
            padding: 20px;
            color: #888;
        }

        .success-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .success-toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .error-toast {
            background: #dc3545;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .logo {
                font-size: 18px;
                line-height: 1.2;
            }

            .header-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            .user-info {
                order: -1;
                justify-content: center;
                font-size: 12px;
            }

            .calendar-header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }

            .calendar-nav {
                gap: 15px;
                width: 100%;
                justify-content: center;
            }

            .month-year {
                font-size: 18px;
                text-align: center;
            }

            .controls {
                width: 100%;
                justify-content: center;
            }

            .btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            .calendar-day {
                min-height: 80px;
                padding: 5px;
                font-size: 12px;
            }

            .day-number {
                margin-bottom: 4px;
                font-size: 12px;
            }

            .event {
                font-size: 10px;
                padding: 2px 4px;
                margin-bottom: 2px;
            }

            .sidebar {
                margin-top: 15px;
                padding: 15px;
            }

            .sidebar h3 {
                font-size: 16px;
            }

            .upcoming-event {
                padding: 10px;
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
            }

            .upcoming-event-image {
                width: 100%;
                height: 120px;
                order: -1;
                border-radius: 8px;
            }

            .upcoming-event-content {
                text-align: center;
            }

            .upcoming-event-title {
                font-size: 14px;
            }

            .upcoming-event-date {
                font-size: 11px;
            }

            .upcoming-event-creator {
                font-size: 10px;
            }

            /* Modal Responsiveness */
            .modal-content {
                width: 95%;
                margin: 10px;
                max-height: 90vh;
            }

            .modal-header {
                padding: 15px;
            }

            .modal-title {
                font-size: 18px;
            }

            .modal-body {
                padding: 15px;
            }

            .modal-footer {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
            }

            .modal-footer .btn {
                width: 100%;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .form-input, .form-select, .form-textarea {
                padding: 12px;
                font-size: 16px;
            }

            .upload-area {
                padding: 20px;
            }

            .preview-field {
                flex-direction: column;
                gap: 5px;
                margin-bottom: 12px;
            }

            .preview-label {
                min-width: auto;
                font-size: 14px;
            }

            .preview-image {
                max-height: 200px;
            }

            .search-input {
                font-size: 16px;
                padding: 12px;
            }

            .terms-checkbox {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .terms-checkbox input[type="checkbox"] {
                margin-top: 0;
            }

            .auth-modal .modal-content {
                max-width: 95%;
            }

            .google-btn {
                padding: 15px;
                font-size: 16px;
            }

            .admin-delete-btn {
                font-size: 12px;
                padding: 4px 8px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 16px;
            }

            .calendar-day {
                min-height: 60px;
                padding: 3px;
            }

            .day-number {
                font-size: 11px;
            }

            .event {
                font-size: 9px;
                padding: 1px 3px;
            }

            .month-year {
                font-size: 16px;
            }

            .nav-btn {
                padding: 6px 10px;
                font-size: 16px;
            }

            .modal-content {
                width: 98%;
                margin: 5px;
            }

            .modal-header, .modal-body, .modal-footer {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">The Black Experience Community Calendar</div>
            <div class="header-controls">
                <div class="user-info" id="userInfo" style="display: none;">
                    <span id="userName"></span>
                    <button class="btn btn-logout" onclick="logout()">Logout</button>
                </div>
                <button class="btn btn-secondary" onclick="showHelp()">Help</button>
                <button class="btn btn-auth" id="authButton" onclick="handleAuthButtonClick()">Log in to post</button>
            </div>
        </div>

        <!-- Calendar -->
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="previousMonth()">‚Äπ</button>
                    <div class="month-year" id="monthYear">September 2025</div>
                    <button class="nav-btn" onclick="nextMonth()">‚Ä∫</button>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="goToToday()">Today</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <!-- Upcoming Events -->
        <div class="sidebar">
            <h3>Upcoming Events</h3>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search upcoming events...">
            </div>
            <div id="upcomingEvents">
                <div class="no-events">
                    <p>üìÖ No upcoming events</p>
                    <p style="font-size: 12px;">Be the first to create an event!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="authModalTitle">Log In</div>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-toggle">
                    <span id="authToggleText">Don't have an account?</span>
                    <span class="toggle-link" id="authToggleLink" onclick="toggleAuthMode()">Sign up</span>
                </div>
                
                <form id="authForm" onsubmit="handleAuthSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="authEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="authPassword" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="authSubmitBtn">Log In</button>
                </form>
                
                <div class="divider">
                    <span>or</span>
                </div>
                
                <button class="google-btn" onclick="signInWithGoogle()">
                    <span>üîê</span>
                    Continue with Google
                </button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal with Terms -->
    <div id="onboardingModal" class="modal onboarding-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Complete Your Profile</div>
            </div>
            <div class="modal-body">
                <form id="onboardingForm" onsubmit="handleOnboardingSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="fullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" class="form-input" id="phoneNumber" placeholder="(555) 123-4567" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contact Email *</label>
                        <input type="email" class="form-input" id="contactEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company Name *</label>
                        <input type="text" class="form-input" id="companyName" placeholder="Your company or organization" required>
                    </div>

                    <!-- Terms and Disclaimer Section -->
                    <div style="background: #3a3a3a; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ffd700;">
                        <h4 style="color: #ffd700; margin-bottom: 15px;">Terms & Community Guidelines</h4>
                        
                        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; font-size: 13px; line-height: 1.5;">
                            <p style="margin-bottom: 10px;"><strong>By using The Black Experience Community Calendar, you agree to:</strong></p>
                            
                            <ul style="margin-bottom: 15px; padding-left: 20px;">
                                <li>Post only community-appropriate, family-friendly events</li>
                                <li>Provide accurate event information</li>
                                <li>Respect community guidelines and avoid offensive content</li>
                                <li>Take responsibility for your own event attendance and safety</li>
                            </ul>
                            
                            <p style="margin-bottom: 10px;"><strong>Important Disclaimer:</strong></p>
                            <p style="margin-bottom: 10px;">The Black Experience Community Calendar and BXE LLC are not responsible for events posted by community members, event cancellations, changes, or any damages, injuries, or losses related to attended events. You attend events at your own risk and are responsible for verifying event details.</p>
                            
                            <p style="margin-bottom: 10px;"><strong>We reserve the right to:</strong></p>
                            <ul style="margin-bottom: 10px; padding-left: 20px;">
                                <li>Remove content that violates our guidelines</li>
                                <li>Suspend accounts for repeated violations</li>
                                <li>Moderate all posted content</li>
                            </ul>
                        </div>
                        
                        <div class="terms-checkbox">
                            <input type="checkbox" id="termsCheckbox" required>
                            <label for="termsCheckbox" class="terms-text">
                                <strong>I have read and agree to the above terms, community guidelines, and disclaimer.</strong>
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="onboardingSubmitBtn">
                        Complete Setup
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Create Event</div>
                <button class="close-btn" onclick="closeEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Event Title *</label>
                    <input type="text" class="form-input" id="eventTitle" placeholder="Enter event title" required>
                    <div class="error-message" id="titleError">Please enter an event title</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date & Time *</label>
                        <input type="datetime-local" class="form-input" id="startDate" required>
                        <div class="error-message" id="startError">Please select a start date</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date & Time *</label>
                        <input type="datetime-local" class="form-input" id="endDate" required>
                        <div class="error-message" id="endError">Please select an end date</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="location" placeholder="Event location">
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="description" placeholder="Event details"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Created by</label>
                    <input type="text" class="form-input" id="createdByName" readonly style="background: #222; color: #888;">
                </div>

                <div class="form-group">
                    <label class="form-label">Event Image</label>
                    <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
                        <div id="uploadText">
                            <div style="font-size: 24px; margin-bottom: 8px;">üì∑</div>
                            <div>Click to upload image or drag and drop</div>
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">PNG, JPG up to 5MB</div>
                        </div>
                        <div id="imagePreview" style="display: none;"></div>
                    </div>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeEventModal()">Cancel</button>
                <button class="btn btn-primary" id="saveEventBtn" onclick="saveEvent()">Create Event</button>
            </div>
        </div>
    </div>

    <!-- Event Preview Modal -->
    <div id="eventPreviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="previewEventTitle">Event Details</div>
                <button class="close-btn" onclick="closeEventPreviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="previewEventImage" style="margin-bottom: 20px;"></div>
                
                <div class="preview-info">
                    <div class="preview-field">
                        <span class="preview-label">üìÖ Start:</span>
                        <span id="previewEventStart"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üèÅ End:</span>
                        <span id="previewEventEnd"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üìç Location:</span>
                        <span id="previewEventLocation"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üìù Description:</span>
                        <span id="previewEventDescription"></span>
                    </div>
                    
                    <div class="preview-field">
                        <span class="preview-label">üë§ Created by:</span>
                        <span id="previewEventCreator"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div id="eventOwnerControls" style="display: none; gap: 10px;">
                    <button class="btn btn-secondary" onclick="editCurrentEvent()">Edit Event</button>
                    <button class="btn btn-danger" onclick="deleteCurrentEvent()">Delete Event</button>
                </div>
                <button class="btn btn-cancel" onclick="closeEventPreviewModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Terms of Service</div>
                <button class="close-btn" onclick="closeTermsModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <h4 style="color: #ffd700; margin-bottom: 15px;">Acceptance of Terms</h4>
                <p style="margin-bottom: 15px;">By using The Black Experience Community Calendar, you agree to these Terms of Service and all applicable laws and regulations.</p>
                
                <h4 style="color: #ffd700; margin-bottom: 15px;">Event Posting Guidelines</h4>
                <ul style="margin-bottom: 15px; padding-left: 20px;">
                    <li>Events must be community-appropriate and family-friendly</li>
                    <li>No hate speech, discrimination, or offensive content</li>
                    <li>No illegal activities or inappropriate solicitation</li>
                    <li>Commercial events must benefit the community</li>
                    <li>Accurate information required - false events will be removed</li>
                </ul>
                
                <h4 style="color: #ffd700; margin-bottom: 15px;">Liability Disclaimer</h4>
                <p style="margin-bottom: 15px;"><strong>The Black Experience Community Calendar and BXE
